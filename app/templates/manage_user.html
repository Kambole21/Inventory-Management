{% extends 'layout.html' %}

{% block content %}
<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='manage.css') }}">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

<main class="container-fluid py-4">
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <div class="alert alert-{{ 'success' if category == 'success' else 'danger' }} alert-dismissible fade show" role="alert">
                    {{ message }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
            {% endfor %}
        {% endif %}
    {% endwith %}

    <h2 class="mt-4 text-purple">User Management</h2>
    <div class="table-responsive">
        <table class="table table-bordered table-sm">
            <thead class="table-light">
                <tr>
                    <th>Email</th>
                    <th>Name</th>
                    <th>Role</th>
                    <th>Phone Number</th>
                    <th>Student Number</th>
                    <th>Status</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% if pending_users %}
                    {% for user in pending_users %}
                        <tr>
                            <td>{{ user.email }}</td>
                            <td>{{ user.fname }} {{ user.lname }}</td>
                            <td>{{ user.role }}</td>
                            <td>{{ user.phone_number }}</td>
                            <td>{{ user.student_number if user.student_number else 'N/A' }}</td>
                            <td>{{ user.status }}</td>
                            <td>
                                <div class="action-buttons">
                                    <form method="POST" action="{{ url_for('manage_user.manage') }}" style="display: inline;">
                                        <input type="hidden" name="user_id" value="{{ user._id }}">
                                        <button type="submit" name="action" value="approve" class="btn btn-sm btn-success" title="Approve">
                                            <i class="fa-solid fa-check"></i>
                                        </button>
                                    </form>
                                    <form method="POST" action="{{ url_for('manage_user.manage') }}" style="display: inline;">
                                        <input type="hidden" name="user_id" value="{{ user._id }}">
                                        <button type="submit" name="action" value="deny" class="btn btn-sm btn-danger" title="Deny">
                                            <i class="fa-solid fa-times"></i>
                                        </button>
                                    </form>
                                </div>
                            </td>
                        </tr>
                    {% endfor %}
                {% else %}
                    <tr>
                        <td colspan="7" class="text-center">No pending users found.</td>
                    </tr>
                {% endif %}
            </tbody>
        </table>
    </div>
</main>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
    $(document).ready(function() {
        // Debug form submissions
        $('form').on('submit', function(e) {
            console.log('Form submitted to:', $(this).attr('action'));
            const formData = $(this).serialize();
            console.log('Form data:', formData);
        });
    });
</script>
{% endblock %}